{
  "hash": "dca4749f2a979b33929ad0b6e1dcd97b",
  "result": {
    "markdown": "---\ntitle: \"Take-home_Ex03\"\nauthor: \"Mohamad Hafez Sidek\"\ndate: \"June 9, 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n  message: false\n---\n\n\n**Installing R Packages**\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(ggraph,dendextend,tidygraph,jsonlite,dplyr,lubridate,igraph,ggplot2,gridExtra,ggdendro,ape)\n```\n:::\n\n---\n\n***Load JSON data***\n\n---\n\n::: {.cell}\n\n```{.r .cell-code}\njson_data <- fromJSON('data/MC3/mc3.json')\n```\n:::\n\n---\n\n***Extract the nodes and edges***\n\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nnodes <- json_data$nodes\nedges <- json_data$links\n```\n:::\n\n---\n\n***Data Processing***\n\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ensure 'id' columns and edge 'source'/'target' columns are character type\nnodes$id <- as.character(nodes$id)\nedges$source <- as.character(edges$source)\nedges$target <- as.character(edges$target)\n\n# Ensure edges are not NULL\nif (is.null(edges)) {\n  edges <- data.frame()\n}\n\n# Convert date columns to Date type\nedges$end_date <- as.Date(edges$end_date)\n\n# Check for NA or empty values in the node IDs or edge source/target\nif (any(is.na(nodes$id) | nodes$id == \"\")) {\n  stop(\"NA or empty values found in node IDs.\")\n}\nif (any(is.na(edges$source) | edges$source == \"\" | is.na(edges$target) | edges$target == \"\")) {\n  stop(\"NA or empty values found in edge source or target.\")\n}\n\n# Remove rows with NA or empty values\nnodes <- nodes %>% filter(!is.na(id) & id != \"\")\nedges <- edges %>% filter(!is.na(source) & source != \"\" & !is.na(target) & target != \"\")\n\n# Ensure unique id values\nnodes$id <- make.unique(nodes$id)\n\n# Replace NA values in id with a unique identifier\nnodes$id[is.na(nodes$id)] <- paste0(\"NA_\", seq_along(nodes$id[is.na(nodes$id)]))\n\n# Create a new label combining company name and revenue\nnodes$label <- paste(nodes$id,\",Rev:\", nodes$revenue)\n\n# Function to perform BFS\nbfs <- function(edges, start_node) {\n  adj_list <- list()\n  for (i in 1:nrow(edges)) {\n    source <- edges[i, \"source\"]\n    target <- edges[i, \"target\"]\n    if (!source %in% names(adj_list)) adj_list[[source]] <- c()\n    if (!target %in% names(adj_list)) adj_list[[target]] <- c()\n    adj_list[[source]] <- c(adj_list[[source]], target)\n    adj_list[[target]] <- c(adj_list[[target]], source)\n  }\n  \n  visited <- setNames(rep(FALSE, length(adj_list)), names(adj_list))\n  queue <- c(start_node)\n  visited[start_node] <- TRUE\n  \n  while (length(queue) > 0) {\n    node <- queue[1]\n    queue <- queue[-1]\n    neighbors <- adj_list[[node]]\n    for (neighbor in neighbors) {\n      if (!visited[neighbor]) {\n        queue <- c(queue, neighbor)\n        visited[neighbor] <- TRUE\n      }\n    }\n  }\n  return(names(visited[visited]))\n}\n\n# Find all nodes connected to \"SouthSeafood Express Corp\"\ntarget_company <- \"SouthSeafood Express Corp\"\nconnected_nodes <- bfs(edges, target_company)\n\n# Filter the nodes and edges based on connected nodes\nfiltered_nodes <- nodes %>% filter(id %in% connected_nodes)\nfiltered_edges <- edges %>% filter(source %in% connected_nodes & target %in% connected_nodes)\n\n# Move 'source' and 'target' columns to the leftmost positions\nfiltered_edges <- filtered_edges %>% select(source, target, everything())\nfiltered_nodes <- filtered_nodes %>% select(id, everything())\n\n# Key date\nkey_date <- as.Date(\"2035-05-25\")\n\n# Separate the edges based on the key date\nbefore_edges <- filtered_edges %>% filter(is.na(end_date) | end_date <= key_date)\nafter_edges <- filtered_edges %>% filter(is.na(end_date) | end_date >= key_date)\n```\n:::\n\n***Problem Statement 1:***\nIdentify the network associated with SouthSeafood Express Corp and visualize how this network and competing businesses change as a result of their illegal fishing behavior.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to create a dendrogram plot using ggdendro\ncreate_dendrogram <- function(nodes, edges, plot_title) {\n  # Create tidygraph object\n  graph <- tbl_graph(nodes = nodes, edges = edges, directed = FALSE)\n  \n  # Calculate shortest path distances\n  dist_matrix <- distances(graph, to = V(graph), mode = \"all\")\n  \n  # Create a hierarchical clustering object\n  hc <- hclust(as.dist(dist_matrix), method = \"complete\")\n  \n  # Convert to a dendrogram object\n  dend <- as.dendrogram(hc)\n  \n  # Convert the dendrogram to a format suitable for ggplot\n  dend_data <- dendro_data(dend)\n  \n  # Extract node labels\n  labels <- nodes$label[as.integer(dend_data$labels$label)]\n  \n  # Plot the dendrogram using ggdendro\n  ggplot() +\n    geom_segment(data = segment(dend_data), aes(x = x, y = y, xend = xend, yend = yend)) +\n    geom_text(data = label(dend_data), aes(x = x, y = y, label = labels), hjust = 0, size = 3) +\n    coord_flip() +\n    scale_y_reverse(expand = c(0.2, 0)) +\n    ggtitle(plot_title) +\n    theme_minimal() +\n    theme(plot.margin = unit(c(1, 1, 1, 1), \"cm\")) \n}\n\n# Create and plot the \"before\" dendrogram\ncreate_dendrogram(filtered_nodes, before_edges, \"Before 2035-05-25\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Create and plot the \"after\" dendrogram\ncreate_dendrogram(filtered_nodes, after_edges, \"After 2035-05-25\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n***Analysis***\nBefore the Incident (2035-05-25)\nSouthSeafood Express Corp was closely connected to:\nNamorna Transit Ltd.\nAguaLeska Transit N.V.\nV. Miesel Shipping\nTainamarine Fishing Co\nElise Hauser\nNaddi Conti\nLiam Conti\nSavanteak Creek Solutions NV\nOka Seafood Shipping Ges.m.b.h.\nFintan Park\nRafael Sanchez\nNyanzaRiver Worldwides A/S\nKisumaSeafoodBrothers Ltd.\nFabio Conti\nRecHfish Freight Plc.\nJames Bell\nThe News Buoy\nSamuel Conti\nAfter the Incident (2035-05-25)\nSouthSeafood Express Corp is still present in the network but with some changes in its connections:\nThe same immediate connections (Namorna Transit Ltd., AguaLeska Transit N.V.) remain.\nThe branch it belongs to appears more consolidated, indicating possibly tighter or more scrutinized relationships.\nObservations\nDirect Network Stability:\n\nThe core network around SouthSeafood Express Corp remains relatively stable, with primary connections like Namorna Transit Ltd. and AguaLeska Transit N.V. still intact.\nBranch Consolidation:\n\nPost-incident, the branch including SouthSeafood Express Corp appears to have consolidated. This could indicate closer scrutiny or stronger ties among these entities to mitigate risks or manage fallout from the incident.\nMinor Shifts in Indirect Connections:\n\nSome indirect connections appear to have shifted or been restructured. For example, there are fewer connections extending from nodes like V. Miesel Shipping and Tainamarine Fishing Co, suggesting possible distancing or reduced interaction.\nCompeting Businesses' Positioning:\n\nCompeting businesses such as ArawakFish Cargo Ges.m.b.h., Sanaa El-Amin, and Macaama Ocean Worldwide LLC maintain their positions, indicating that the incident did not significantly disrupt their hierarchical standing.\nNew Alliances and Relationships:\n\nThe dendrogram indicates potential new alliances or strengthened relationships post-incident, especially among companies within close hierarchical proximity to SouthSeafood Express Corp.\nConclusion\nThe incident involving SouthSeafood Express Corp did not drastically alter its immediate network, but it did lead to some consolidation and minor shifts in relationships. The stability of its core connections suggests that the network has adapted to the incident, possibly through strengthened alliances or increased scrutiny to manage the impact. Competing businesses have maintained their positions, indicating that while there were some changes, the overall market structure remains stable. Further detailed data analysis would be needed to understand the specific nature of these relationship changes.\n\n----\n\n***Problem Statement 2:***\n Which companies benefited from SouthSeafood Express Corp legal troubles? \n\n***Analysis***\n\nTo determine which companies benefited from SouthSeafood Express Corp's legal troubles, we should look at the changes in the dendrogram before and after the incident. Companies that appear to have strengthened their positions or gained new connections post-incident are likely to have benefited.\n\nAnalysis of Benefiting Companies\n1. GvardeyskAmerica Shipping Plc\nThis company appears to have a stronger position in the post-incident dendrogram, with several new connections. This suggests it may have capitalized on the market opportunity created by SouthSeafood Express Corp's legal troubles.\n2. ArawakFish Cargo Ges.m.b.h.\nPositioned near the top in both dendrograms, ArawakFish Cargo Ges.m.b.h. seems to have retained a strong market position. The stability and potential new indirect connections imply it might have absorbed some of the business fallout.\n3. Macaama Ocean Worldwide LLC\nSimilar to ArawakFish, this company maintains its position and potentially gains from reduced competition from SouthSeafood Express Corp.\n4. Oka Charter Boat Transport OJSC\nAnother company that shows a stable and potentially strengthened network post-incident.\n5. Naddi Conti and Liam Conti\nThese companies, originally in the same branch as SouthSeafood Express Corp, seem to have fewer but stronger connections post-incident, indicating they might have consolidated or absorbed some of the business.\n6. Namorna Transit Ltd. and AguaLeska Transit N.V.\nDespite being closely linked with SouthSeafood Express Corp, their continued presence and potential new connections suggest they managed to navigate the troubles effectively, possibly gaining from changes in the network dynamics.\n7. StichtingMarine Shipping Company\nAppears to have a stronger presence post-incident, indicating it might have captured some market share or business that SouthSeafood Express Corp lost.\n8. Savanteak Creek Solutions NV\nShows signs of increased importance or new connections, which can be a direct benefit from the incident.\n9. NyanzaRiver Worldwides A/S and KisumaSeafoodBrothers Ltd.\nThese companies have maintained their positions and might have benefited indirectly through reduced competition or new partnerships.\n10. RecHfish Freight Plc.\nThis company shows a potential strengthening of its position in the post-incident network.\nSummary\nThe companies that appear to have benefited the most from SouthSeafood Express Corp's legal troubles include:\n\nGvardeyskAmerica Shipping Plc\nArawakFish Cargo Ges.m.b.h.\nMacaama Ocean Worldwide LLC\nOka Charter Boat Transport OJSC\nNaddi Conti\nLiam Conti\nNamorna Transit Ltd.\nAguaLeska Transit N.V.\nStichtingMarine Shipping Company\nSavanteak Creek Solutions NV\nNyanzaRiver Worldwides A/S\nKisumaSeafoodBrothers Ltd.\nRecHfish Freight Plc.\nThese companies have either gained new connections, strengthened existing ones, or maintained a stable position while others might have struggled, suggesting they capitalized on the market disruptions caused by SouthSeafood Express Corp's legal issues.\n----\n\n***Problem Statement 3:***\nAre there any other suspicious transactions that may be related to illegal fishing?\n\n----\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert nodes to a data frame for filtering purposes\nnodes_df <- as.data.frame(nodes)\n\n# Filter the dataset for companies involved in fishing, sea food, and seafood\nfishing_companies <- nodes_df %>%\n  filter(grepl(\"fish|sea food|seafood\", TradeDescription, ignore.case = TRUE))\n\n# Remove rows with missing or non-finite revenue values\nfishing_companies <- fishing_companies %>%\n  filter(!is.na(revenue) & is.finite(revenue))\n\n# Identify top outliers by revenue (95th percentile)\ntop_outliers <- fishing_companies %>%\n  filter(revenue > quantile(revenue, 0.95, na.rm = TRUE))\n\n# Extract the IDs of the top outliers\ntop_outlier_ids <- top_outliers$id\n\n# Convert edges to a data frame for filtering purposes\nedges_df <- as.data.frame(edges)\n\n# Filter edges to include only those related to top outliers\nrelated_edges <- edges_df %>%\n  filter(source %in% top_outlier_ids | target %in% top_outlier_ids)\n\n# Create an edge list for igraph\nedge_list <- as.matrix(related_edges[, c(\"source\", \"target\")])\n```\n:::\n\n\n----\n\nCreate graph\n\n----\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create graph object\ng <- graph_from_edgelist(edge_list, directed = FALSE)\n\n# Add vertex attributes for revenue and country\nV(g)$revenue <- ifelse(V(g)$name %in% top_outliers$id, top_outliers$revenue[match(V(g)$name, top_outliers$id)], NA)\nV(g)$country <- ifelse(V(g)$name %in% top_outliers$id, top_outliers$country[match(V(g)$name, top_outliers$id)], NA)\n\n# Set node sizes and colors\nV(g)$size <- ifelse(V(g)$name %in% top_outliers$id, 10, 5)  # Increase size for top outliers\nV(g)$color <- ifelse(V(g)$name %in% top_outliers$id, \"skyblue\", \"red\")  # Different colors for top outliers\nV(g)$shape <- ifelse(V(g)$name %in% top_outliers$id, \"square\", \"circle\")  # Different shapes for top outliers\nE(g)$color <- adjustcolor(\"gray\", alpha.f = 0.5)  # Transparent edges\n\n\n\n# Plot the network graph\nplot(g, vertex.size = V(g)$size, vertex.label.cex = ifelse(V(g)$name %in% top_outliers$id, 0.8, 0.6), \n     vertex.color = V(g)$color, vertex.shape = V(g)$shape,\n     vertex.label = NA, \n     edge.color = E(g)$color, layout = layout_with_fr, \n     main = \"Network Graph of Top Revenue Outliers\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex03_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n***Analysis***\nPotential Implications for Suspicious Transactions Related to Illegal Fishing:\nRole of Central Nodes:\n\n***Point 1**\nThe central nodes (skyblue squares) with many connections could be orchestrating significant activities within the network.\nTheir prominent role and high connectivity suggest they might be key players in suspicious transactions related to illegal fishing.\n\n\n***Point 2**\nDense Clusters:The dense clusters around these central nodes indicate high levels of transactional activity.\nThis could be a sign of coordinated efforts to obscure illegal fishing activities through multiple layers of transactions.\nIsolation of Transactions:\n\n***Point 3**\nThe presence of smaller, isolated subgroups suggests attempts to hide certain transactions from the main network.\nThese isolated groups might be used to carry out suspicious activities without drawing attention.\n\n\n***Point 4**\nSystematic Patterns:The repeated patterns of smaller clusters connected to central nodes indicate a systematic approach to transactions.\nThis systematic behavior could be indicative of coordinated efforts to manage and conceal illegal activities related to fishing.\n\n***Conclusion:***\nBased on the analysis of the network graph, there are several visual hints that suggest the possibility of suspicious transactions related to illegal fishing. The prominent role of the central nodes, the dense clusters of transactions, the isolated subgroups, and the systematic patterns all point towards potential coordinated efforts to obscure illegal activities. Further investigation into the nature of these transactions and the entities involved is warranted to confirm these suspicions.\n\n\n",
    "supporting": [
      "Take-home_Ex03_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}